# File Index

Generated by `scripts/doc/gen_file_index.py`.

### src/data/__init__.py
**Purpose:** N/A

### src/data/collate.py
**Purpose:** N/A

**Key Functions/Classes**
- `collate_framewise()`

### src/data/omaps_dataset.py
**Purpose:** N/A

**Key Functions/Classes**
- `_expand_root()`
- `_list_videos()`
- `_read_manifest()`
- `_load_clip_decord()`
- `_load_clip_cv2()`
- `_tile_vertical()`
- `_labels_from_txt()`
- `_read_txt_events()`
- `_load_clip_with_random_start()`
- `_build_frame_targets()`
- class `OMAPSDataset`
- `make_dataloader()`

### src/models/__init__.py
**Purpose:** N/A

### src/models/factory.py
**Purpose:** N/A

**Key Functions/Classes**
- `_get()`
- `build_model()`

### src/models/tivit_piano.py
**Purpose:** N/A

**Key Functions/Classes**
- class `TubeletEmbed`
- class `TransformerBlock`
- class `FactorizedSpaceTimeEncoder`
- class `TiViTPiano`

### src/utils/__init__.py
**Purpose:** N/A

### src/utils/config.py
**Purpose:** N/A

**Key Functions/Classes**
- `load_config()`

### src/utils/logging.py
**Purpose:** N/A

**Key Functions/Classes**
- `setup_logging()`
- `get_logger()`

### src/utils/pitch.py
**Purpose:** Pitch utility helpers.

**Key Functions/Classes**
- `align_pitch_dim()`

### scripts/calibrate.py
**Purpose:** N/A

**Key Functions/Classes**
- `load_cfg()`
- `save_cfg()`
- `set_yaml()`
- `run_sweep()`
- `main()`

**CLI**
| Flags | Type | Default | Help |
|---|---|---|---|
| `--epochs` | int | 2 | Epochs per run. |
| `--max_clips` | int | 2 | Dataset clips per split for fast sweeps. |
| `--results` |  | calibration_results.txt | Where to append results. |
| `--tag` |  |  | Tag added to experiment names. |
| `--skip_bias_toggle` | store_true |  | Skip the reset_head_bias OFF/ON comparison. |

### scripts/calibrate_thresholds.py
**Purpose:** N/A

**Key Functions/Classes**
- `_pool_roll_BT()`
- `_binary_f1()`
- `_reliability_curve()`
- `_collect()`
- `_compute_metrics()`
- `main()`

**CLI**
| Flags | Type | Default | Help |
|---|---|---|---|
| `--ckpt` |  | checkpoints/tivit_best.pt |  |
| `--split` |  |  | Dataset split to evaluate |
| `--max-clips` | int |  |  |
| `--frames` | int |  |  |
| `--stride` | int |  |  |

### scripts/check_model.py
**Purpose:** N/A

**Key Functions/Classes**
- `main()`

### scripts/check_omaps_integrity.py
**Purpose:** N/A

**Key Functions/Classes**
- `read_labels()`
- `ffprobe_info()`
- `scan_split()`
- `write_json()`
- `write_tsv()`
- `summarize()`
- `main()`

**CLI**
| Flags | Type | Default | Help |
|---|---|---|---|
| `--root` | Path |  | Dataset root that contains 'train' and 'test' subfolders |
| `--probe-media` | store_true |  | Use ffprobe to log FPS/resolution/audio rate if available |
| `--meta-dir` | Path |  |  |
| `--report-dir` | Path |  |  |

### scripts/clean_tivit.py
**Purpose:** N/A

**Key Functions/Classes**
- `rm_path()`
- `load_cfg_paths()`
- `assert_project_layout()`
- `is_within()`
- `list_targets()`
- `delete_groups()`
- `main()`

**CLI**
| Flags | Type | Default | Help |
|---|---|---|---|
| `--project-root` | Path |  | Path to TiViT repo root. |
| `--dry-run` | store_true |  | Preview actions only. |
| `--yes, -y` | store_true |  | No prompt. |
| `--preset` |  | pre-run | 'pre-run' removes logs, checkpoints, caches, tmp and __pycache__ (leave code & configs intact). |
| `--keep-best` | store_true |  | When removing checkpoints, keep files with 'best' in their name. |
| `--delete-logs` | store_true |  |  |
| `--delete-checkpoints` | store_true |  |  |
| `--delete-caches` | store_true |  |  |
| `--delete-tmp` | store_true |  |  |
| `--delete-pycache` | store_true |  |  |
| `--ignore-config-paths` | store_true |  | Do not read configs/config.yaml; assume logs/ and checkpoints/. |

### scripts/diagnose_onset_offsets.py
**Purpose:** N/A

**Key Functions/Classes**
- `pick_input_tensor()`
- `find_logits()`
- `summarize()`

**CLI**
| Flags | Type | Default | Help |
|---|---|---|---|
| `--config` |  | configs/config.yaml |  |
| `--ckpt` |  | checkpoints/tivit_best.pt |  |
| `--split` |  | train |  |
| `--batches` | int | 5 |  |
| `--device` |  | auto |  |

### scripts/dump_labels.py
**Purpose:** N/A

**Key Functions/Classes**
- `pick_train_loader()`
- `describe_tensor()`
- `main()`

### scripts/eval_thresholds.py
**Purpose:** N/A

**Key Functions/Classes**
- `_parse_list()`
- `_binary_f1()`
- `_pool_roll_BT()`
- `main()`

**CLI**
| Flags | Type | Default | Help |
|---|---|---|---|
| `--ckpt` |  | checkpoints/tivit_best.pt |  |
| `--thresholds` |  |  | Logit threshold values |
| `--prob_thresholds` |  |  | Probability threshold values |
| `--calibration` |  |  | JSON file with calibrated thresholds |
| `--head` |  |  | Sweep thresholds for only one head |
| `--fixed_offset_prob` | float |  |  |
| `--fixed_offset_logit` | float |  |  |
| `--fixed_onset_prob` | float |  |  |
| `--fixed_onset_logit` | float |  |  |
| `--temperature` | float | 1.0 | Scale logits by this temperature before sigmoid; >1 softens predictions |
| `--bias` | float | 0.0 | Additive bias applied to logits before sigmoid |
| `--split` |  |  | Dataset split to evaluate |
| `--max-clips` | int |  |  |
| `--frames` | int |  |  |
| `--stride` | int |  |  |
| `--debug` | store_true |  | Log extra diagnostics for first batch |

### scripts/inspect_ckpt.py
**Purpose:** N/A

### scripts/make_calib_split.py
**Purpose:** N/A

**Key Functions/Classes**
- `load_train_meta()`
- `quantile_cuts()`
- `assign_bin()`
- `write_stem_list()`
- `main()`

**CLI**
| Flags | Type | Default | Help |
|---|---|---|---|
| `--meta-train` | Path |  | Path to Step 0 output for the TRAIN split |
| `--calib-frac` | float | 0.1 | Fraction of TRAIN to sample (per speed bin) |
| `--bins` | int | 5 | Number of quantile bins for notes/sec |
| `--seed` | int | 42 |  |
| `--out-dir` | Path |  |  |
| `--symlink-out` | Path |  | Optional directory to symlink the calib subset (videos+labels) |

### scripts/parse_sweep.py
**Purpose:** N/A

**Key Functions/Classes**
- `to_num_or_none()`
- `parse_val_line()`
- `main()`

**CLI**
| Flags | Type | Default | Help |
|---|---|---|---|
| `--results` |  | sweep_results.txt | Path to results file. |
| `--out_csv` |  | sweep_summary.csv | Output CSV path. |
| `--out_md` |  | sweep_summary.md | Output Markdown table path. |
| `--sort_by` |  | onset_f1 | Metric to sort by (desc). Use '-metric' for ascending, e.g., '-total'. |
| `--filter_retcode` | int | 0 | Keep only rows with this retcode. Set to -1 to keep all. |

### scripts/sweep.py
**Purpose:** N/A

**Key Functions/Classes**
- `load_yaml()`
- `dump_yaml()`
- `slug()`
- `short_id()`
- `parse_list()`
- `base_from_config_name()`
- `run_train()`
- `main()`

**CLI**
| Flags | Type | Default | Help |
|---|---|---|---|
| `--repo` |  | . | Project root (where configs/, scripts/, src/ live). |
| `--python` |  |  | Python executable. |
| `--base_config` |  | configs/config.yaml | Config path relative to repo. |
| `--results` |  | sweep_results.txt | Output results file (relative to repo). |
| `--epochs` | int | None | Override training.epochs for quick sweeps. |
| `--base_exp_name` |  |  | Optional: override base experiment name (else derive from config). |
| `--gamma` |  |  | focal_gamma list, e.g. '1.5,2.0,3.0' |
| `--alpha` |  |  | focal_alpha list, e.g. '0.05,0.10' |
| `--threshold` |  |  | prob_threshold list, e.g. '0.2,0.3,0.4' |
| `--prior_mean` |  |  | onoff_prior_mean list, e.g. '0.01,0.02,0.05' |
| `--prior_weight` |  |  | onoff_prior_weight list, e.g. '0.02,0.05,0.10' |
| `--tolerance` |  |  | frame_targets.tolerance list, e.g. '0.05,0.10' |
| `--dilate` |  |  | frame_targets.dilate_active_frames list, e.g. '0,1,2' |
| `--max_clips` |  |  | dataset.max_clips list, e.g. '2,4' |
| `--tag` |  |  | Optional tag to include in experiment name/logs. |

### scripts/test_forward.py
**Purpose:** N/A

**Key Functions/Classes**
- `main()`

### scripts/test_labels.py
**Purpose:** N/A

**Key Functions/Classes**
- `main()`

### scripts/test_loader.py
**Purpose:** N/A

**Key Functions/Classes**
- `main()`

### scripts/test_synthetic_forward.py
**Purpose:** N/A

**Key Functions/Classes**
- `main()`

### scripts/train.py
**Purpose:** N/A

**Key Functions/Classes**
- `set_seed()`
- `ensure_dirs()`
- `make_criterions()`
- `_print_head_grad_norms()`
- `_pool_roll_BT()`
- `_interp_labels_BT()`
- `_pick_loader()`
- `_time_pool_out_to_clip()`
- class `FocalBCE`
- `_set_onoff_head_bias()`
- `compute_loss()`
- `compute_loss_frame()`
- `fabricate_dummy_targets()`
- `_binary_f1()`
- `_acc_from_logits()`
- `_binarize_sigmoid()`
- `train_one_epoch()`
- `save_checkpoint()`
- `evaluate_one_epoch()`
- `main()`

**CLI**
| Flags | Type | Default | Help |
|---|---|---|---|
| `--config` |  | configs/config.yaml |  |
| `--train-split` |  |  | Dataset split for training |
| `--val-split` |  |  | Validation split |
| `--max-clips` | int |  |  |
| `--frames` | int |  |  |
| `--stride` | int |  |  |
| `--debug` | store_true |  | Enable verbose logging |
| `--smoke` | store_true |  | Run a quick synthetic pass |

### configs/config.yaml
Top-level keys: experiment, dataset, model, training, optim, train, logging, inference
