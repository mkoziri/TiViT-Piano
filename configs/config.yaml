experiment:
  name: "TiViT-Piano_OMAPS_calib_v5_onsets_only"
  seed: 42
  output_dir: "outputs"

dataset:
  name: "OMAPS"
  root_dir: "./data_calib"
  annotations_root: "./data_calib"
  label_format: "txt"
  max_clips: null
  split_train: "train"
  split_val: "train"
  split_test: "test"
  frames: 96
  stride: 1
  resize: [128, 128]
  tiles: 3
  channels: 3
  batch_size: 1
  num_workers: 0
  shuffle: true
  require_labels: true
  frame_targets:
    enable: true
    tolerance: 0.10  
    dilate_active_frames: 3  
    fill_mode: "overlap"
    hand_from_pitch: true
    clef_thresholds: [60, 64]
    note_min: 0
    note_max: 127
    cache_labels: true
    cache_dir: ".cache/labels"
    targets_sparse: false

model:
  name: "TiViT-Piano"
  head_mode: "frame"
  tiles: 3
  input_channels: 3
  transformer:
    type: "ViViT"
    input_patch_size: 16
    tube_size: 2
    d_model: 192
    num_heads: 3
    depth_temporal: 1
    depth_spatial: 1
    mlp_ratio: 3.0
    dropout: 0.10

training:
  epochs: 5
  learning_rate: 3e-4 
  weight_decay: 0.01
  grad_clip: 1.0
  eval_freq: 1
  debug_dummy_labels: false
  log_interval: 25

  reset_head_bias: true  
  loss_weights:
    pitch: 1.0     
    onset: 5.0     # force the network to learn this. 
    offset: 5.0    # and this. 
    hand: 0.2      
    clef: 0.2      
    focal_gamma: 1.5     
    focal_alpha: 0.15
    onoff_prior_mean: 0.12
    onoff_prior_weight: 0.0  

  metrics:
    prob_threshold: 0.20

logging:
  log_dir: "logs"
  checkpoint_dir: "checkpoints"
  tensorboard: false
  save_every: 1

inference:
  output_dir: "inference_results"
  predict_on_train: false

