experiment:
  name: "TiViT-Piano_OMAPS_calib_v5_onsets_only"
  seed: 42
  output_dir: "outputs"

dataset:
  name: "OMAPS"
  root_dir: "~/datasets/OMAPS"           # adjust if needed
  annotations_root: "~/datasets/OMAPS"   # adjust if needed
  label_format: "txt"
  label_targets: ["pitch", "onset", "offset", "hand", "clef"]
  max_clips: null
  # NEW: manifest files that select which IDs belong to each logical role
  manifest:
    train: splits/train_minus_calib_list.txt
    val:   splits/calib_list.txt
    test:  null                         # test uses the whole test/ folder
  split_train: "train"
  split_val: "train"
  split_test: "test"
  frames: 96
  stride: 1
  resize: [128, 128]
  tiles: 3
  channels: 3
  normalize: true
  batch_size: 1
  num_workers: 0
  shuffle: true
  require_labels: true
  frame_targets:
    enable: true
    tolerance: 0.10  
    dilate_active_frames: 3  
    fill_mode: "overlap"
    hand_from_pitch: true
    clef_thresholds: [60, 64]
    note_min: 0
    note_max: 127
    cache_labels: true
    cache_dir: ".cache/labels"
    targets_sparse: false

model:
  name: "TiViT-Piano"
  head_mode: "frame"
  tiles: 3
  input_channels: 3
  transformer:
    type: "ViViT"
    input_patch_size: 16
    tube_size: 2
    d_model: 192
    num_heads: 3
    depth_temporal: 1
    depth_spatial: 1
    depth_global: 1
    global_tokens: 2
    mlp_ratio: 3.0
    dropout: 0.10

training:
  epochs: 5
  learning_rate: 3e-4
  weight_decay: 0.01
  eval_freq: 1
  debug_dummy_labels: false
  log_interval: 25
  save_every: 1
  amp: false
  resume: false
  reset_head_bias: true
  loss_weights:
    #choose the on/off loss family
    onoff_loss: "bce_pos"          # or "focal"
    
    #if "bce_pos":
    onoff_pos_weight_mode: "adaptive"  # "adaptive" or "fixed"
    onoff_pos_weight: 0.0              # used only when mode == "fixed"
    onoff_neg_smooth: 0.00             # e.g., 0.02 if you need it
    
    # focal params (used only when onoff_loss == "focal")
    focal_gamma: 2.0
    focal_alpha: 0.25
    
    # light prior (keep 0.00 while fixing heads; re-enable later if you want)
    onoff_prior_mean: 0.12
    onoff_prior_weight: 0.00
    
    # per-task weights
    onset: 5.0
    offset: 5.0
    pitch: 1.0
    hand: 0.2
    clef: 0.2

  metrics:
    prob_threshold: 0.20

optim:
  grad_clip: 1.0

train:
  accumulate_steps: 1
  freeze_backbone_epochs: 3

logging:
  log_dir: "logs"
  checkpoint_dir: "checkpoints"
  tensorboard: false

inference:
  output_dir: "inference_results"
  predict_on_train: false
