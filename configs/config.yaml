experiment:
  name: TiViT-Piano_PianoYT_preT3_baseline_clean_start
  seed: 1332
  deterministic: true
  output_dir: outputs
dataset:
  name: PianoYT
  root_dir: data/PianoYT
  annotations_root: data/PianoYT
  label_format: txt
  label_targets:
  - pitch
  - onset
  - offset
  - hand
  - clef
  max_clips: 50 #null
  manifest:
    train: null
    val: null
    test: null
  split: train
  split_train: train
  split_val: val
  split_test: test
  frames: 96
  decode_fps: 30.0
  hop_seconds: 0.03333333333333333
  resize:
  - 145
  - 800
  tiles: 3
  channels: 3
  normalize: true
  apply_crop: true
  canonical_hw:
  - 145
  - 800
  registration:
    source: metadata
    interp: bilinear
    global_aug:
      enabled: false
      resize_jitter:
      - 150
      - 805
      random_crop_hw:
      - 145
      - 800
  crop_rescale: auto
  include_low_res: false
  batch_size: 2
  num_workers: 4
  shuffle: true
  require_labels: true
  frame_targets:
    enable: true
    tolerance: 0.03
    dilate_active_frames: 1
    fill_mode: overlap
    hand_from_pitch: true
    clef_thresholds:
    - 60
    - 64
    note_min: 0
    note_max: 127
    cache_labels: true
    cache_dir: .cache/labels
    targets_sparse: true
model:
  name: TiViT-Piano
  head_mode: frame
  tiles: 3
  input_channels: 3
  transformer:
    type: ViViT
    input_patch_size: 16
    tube_size: 2
    d_model: 192
    num_heads: 3
    depth_temporal: 1
    depth_spatial: 1
    depth_global: 1
    global_tokens: 2
    mlp_ratio: 3.0
    dropout: 0.2
tiling:
  patch_w: 16
  tokens_split: auto
  overlap_tokens: 0
training:
  epochs: 10
  learning_rate: 1e-4
  weight_decay: 0.01
  eval_freq: 1
  debug_dummy_labels: false
  log_interval: 25
  save_every: 1
  amp: false
  resume: true
  reset_head_bias: false
  bias_seed:
    onoff_prior_mean: 0.02
  loss_weights:
    onoff_loss: bce_pos
    onoff_pos_weight_mode: fixed
    onoff_pos_weight: 16.0
    onoff_pos_weight_ema_alpha: 0.05
    onoff_neg_smooth: 0.0
    focal_gamma: 2.0
    focal_alpha: 0.25
    onoff_prior_mean: 0.012
    onoff_prior_weight: 0.15
    onoff_heads:
      onset:
        loss: bce_pos
        pos_weight_mode: fixed
        prior_mean: 0.012
        prior_weight: 0.15
      offset:
        loss: focal
        focal_gamma: 3.0
        focal_alpha: 0.20
        prior_mean: 0.010
        prior_weight: 0.25
    onset: 1.8
    offset: 0.6
    pitch: 1.2
    hand: 0.3
    clef: 0.3
  metrics:
    prob_threshold: 0.48
    prob_threshold_onset: 0.48
    prob_threshold_offset: 0.56
    prob_temperature: 1.0
    prob_temperature_onset: 1.0
    prob_temperature_offset: 1.25
    prob_logit_bias: 0.0
    prob_logit_bias_onset: 0.0
    prob_logit_bias_offset: -0.40
    aggregation:
      mode: k_of_p
      k:
        onset: 1
        offset: 1
      top_k: 3
      tau_sum: 0.0
optim:
  grad_clip: 1.0
  head_lr_multiplier: 5.0
  offset_weight_decay_multiplier: 4.0
train:
  accumulate_steps: 12
  freeze_backbone_epochs: 0
logging:
  log_dir: logs
  checkpoint_dir: checkpoints
  tensorboard: true
inference:
  output_dir: inference_results
  predict_on_train: false
